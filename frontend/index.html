<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Enter Receipt</title>
</head>
<body>
    <h1>HEB Receipt Redeemer</h1>
    <form @submit=".submit">
        <label>
            Certificate Code:
            <input
                .form.certificate_code
                type="text" value="" required
                minlength="18" maxlength="20" pattern="[\s0-9]{18,20}"

            />
        </label>
        <label>Date: <input .form.date type="date" value="" required max="2023-12-31" /></label>
        <label>Cashier: <input .form.cashier type="text" value="" required /></label>
        <button type="submit" @click=".submit">Submit</button>
    </form>
    <div .results?>
        <h2>Results</h2>
        <div .results.error?>Error: <span .results.error></span></div>
        <div !results.error?>
            <div>Certificate Code: <span .results.certificate_code></span></div>
            <div>Date: <span .results.date></span></div>
        </div>
    </div>
<script src="http://localhost:8000/bop.js"></script>
<script>
const data = bop(document.body, {
    form: {
        certificate_code: null,
        date: null,
        cashier: "SELF CHECKOUT",
    },
    results: null,
    submit: async (event, data) => {
        event.preventDefault();
        data.results = null;

        const res = await fetch("/redeem", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data.form),
        });

        const results = await res.json();
        console.log(results);
        data.results = results;
    }
});
</script>
</body>
</html>
